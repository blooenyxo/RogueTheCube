using System.Collections;
using UnityEngine;

public class Controller_Character_Body_Invulnerability : MonoBehaviour
{
    public bool invicibilityFrames;

    public Material normal;
    public Material takingDamage;

    private MeshRenderer mr;
    private BoxCollider boxCollider;

    public bool gotHit;
    public float totalInvTime;
    public float blinkInterval;
    private float counter;

    void Start()
    {
        mr = GetComponent<MeshRenderer>();
        boxCollider = GetComponent<BoxCollider>();
        counter = blinkInterval;
    }

    void FixedUpdate()
    {
        if (gotHit)
        {
            counter -= Time.fixedDeltaTime;

            if (counter >= blinkInterval / 2f)
            {
                mr.material = takingDamage;
            }
            else if (counter > 0f && counter < blinkInterval / 2f)
            {
                mr.material = normal;
            }
            else if (counter <= 0f)
            {
                counter = blinkInterval;
            }
        }
    }

    public void Invincible()
    {
        StartCoroutine(InvulnerabilityRoutine());
    }

    public IEnumerator InvulnerabilityRoutine()
    {
        gotHit = true;

        if (invicibilityFrames)
            boxCollider.enabled = false;

        yield return new WaitForSeconds(totalInvTime);

        gotHit = false;
        mr.material = normal;

        if (invicibilityFrames)
            boxCollider.enabled = true;
    }
}